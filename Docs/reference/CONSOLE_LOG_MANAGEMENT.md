# Console Log Management Guide

## Overview
This guide explains how to manage console logging in RAGMLCore, including filtering system warnings and controlling app-specific log verbosity.

## New Developer Settings (Added Oct 2025)

Navigate to: **Settings → Developer Settings**

### Logging Levels

- **Silent (Production)**: No console output - use for App Store builds
- **Error Only**: Critical errors only - minimal logging
- **Warning**: Errors + warnings - catch potential issues
- **Info (Default)**: Errors + warnings + key operations - recommended for development
- **Debug**: Verbose logging - detailed debugging information
- **Verbose (Maximum)**: Everything including token streaming - very high output

### Category Toggles

Fine-tune which parts of the app generate logs:

- ✅ **RAG Pipeline**: Query expansion, retrieval, generation steps
- ✅ **Performance Metrics**: Timing and optimization data
- ✅ **LLM Generation**: Model selection, execution location detection
- ⚠️  **Token Streaming**: Per-token updates (high volume - keep disabled unless debugging streaming)
- ✅ **Vector Database**: Search, storage, cache operations
- ⚠️  **Telemetry Events**: Event tracking (can be verbose)

### Quick Presets

1. **Production (Minimal)**: Level: Error, All categories OFF
2. **Development (Balanced)**: Level: Info, Key categories ON, Streaming OFF
3. **Debug (Maximum)**: Level: Verbose, All categories ON

## System Warnings (Cannot Be Suppressed)

These are iOS framework warnings that appear in the console:

```
void * _Nullable NSMapGet(NSMapTable * _Nonnull, const void * _Nullable): map table argument is NULL
UIKeyboardLayoutStar implements focusItemsInRect: - caching for linear focus movement is limited
containerToPush is nil, will not push anything to candidate receiver for request token
Reporter disconnected. { function=sendMessage, reporterID=... }
[libMTLHud] Metric com.apple.hud-stat.frame-interval already exist
[CAMetalLayerDrawable texture] should not be called after already presenting this drawable
metal-HUD: 30,7.14,141.97,233762677.60,...
```

**These cannot be disabled from app code** - they're generated by:
- Foundation framework (NSMapGet)
- UIKit keyboard system
- Metal rendering layer
- Core Animation layer
- Xcode debugger reporter

## Filtering System Logs in Xcode

### Method 1: Xcode Console Filter (Recommended)

1. Open your app in Xcode
2. Run the app (⌘R)
3. Look at the bottom of the console pane
4. Click the filter icon (funnel) or type in the search box
5. Enter one of these filters:

**Show only your app's logs:**
```
[RAGService]
```

**Hide system warnings:**
```
-NSMapGet -UIKeyboard -Reporter -libMTLHud -CAMetalLayer -metal-HUD
```

**Show only errors:**
```
❌
```

**Show only performance metrics:**
```
✅|⚡️|📊
```

### Method 2: Regex Filter

Click the regex icon (.*) in the console filter bar, then use:

```regex
^\[RAG|^🔍|^✅|^⚡️|^📊|^━━━
```

This shows:
- Lines starting with `[RAG` (RAGService logs)
- Lines starting with emojis (our structured logs)
- Lines starting with separator `━━━` (section headers)

### Method 3: OS_LOG Filtering (Advanced)

Add this to your Xcode scheme:

1. Product → Scheme → Edit Scheme
2. Run → Arguments → Environment Variables
3. Add: `OS_ACTIVITY_MODE` = `disable`

⚠️ **Warning**: This disables ALL os_log messages, including useful system diagnostics.

## Recommended Settings by Scenario

### 🚀 Normal Development
- **Level**: Info
- **Categories**: Pipeline ✅, Performance ✅, LLM ✅, Streaming ❌, VectorDB ✅, Telemetry ❌
- **Xcode Filter**: `-NSMapGet -Reporter -metal-HUD`
- **Result**: Clean logs showing key operations, no spam

### 🐛 Debugging Performance Issues
- **Level**: Debug
- **Categories**: Pipeline ✅, Performance ✅, LLM ✅, Streaming ❌, VectorDB ✅, Telemetry ✅
- **Xcode Filter**: `✅|⚡️|📊`
- **Result**: Detailed timing data, cache hits, optimization metrics

### 🔬 Debugging LLM Streaming
- **Level**: Verbose
- **Categories**: ALL ✅ (including Streaming)
- **Xcode Filter**: `snapshot|📦|━━━`
- **Result**: See every token as it arrives, execution location detection

### 📦 Production/TestFlight Build
- **Level**: Error
- **Categories**: ALL ❌
- **Xcode Filter**: `❌`
- **Result**: Only critical errors logged

### 🎯 Debugging Vector Search
- **Level**: Debug
- **Categories**: Pipeline ✅, VectorDB ✅, Streaming ❌
- **Xcode Filter**: `[VectorDatabase]|[HybridSearch]|🔍`
- **Result**: Search operations, cache hits, similarity scores

## Understanding Log Prefixes

Our app uses consistent prefixes for easy filtering:

| Prefix | Meaning | Example |
|--------|---------|---------|
| `✅` | Success | `✅ [RAGService] Document indexed` |
| `❌` | Error | `❌ [RAGService] Query failed: ...` |
| `⚠️` | Warning | `⚠️ Requested topK=10 but only 5 chunks available` |
| `ℹ️` | Info | `ℹ️ No documents loaded - using direct LLM chat mode` |
| `🔍` | Debug | `🔍 [QueryEnhancement] Expanding query...` |
| `📝` | Verbose | `📝 Generated 3 query variations` |
| `⚡️` | Performance | `⚡️ Cache hit! Returning 3 cached results` |
| `📦` | Data | `📦 Snapshot #1: Content length: 66 chars` |
| `━━━` | Section | `━━━ Step 1: Query Expansion ━━━` |
| `╔══╗` | Box | `╔══════════════════════════════════╗` |

## Example: Clean Development Logs

**Before** (Default iOS verbose):
```
void * _Nullable NSMapGet...
Reporter disconnected...
[libMTLHud] Metric...
metal-HUD: 30,7.14,141.97...
✅ [RAGService] Loaded 9 documents
UIKeyboardLayoutStar implements...
Reporter disconnected...
✓ Using Apple Foundation Models
containerToPush is nil...
```

**After** (Developer Settings: Info level + Xcode filter):
```
✅ [RAGService] Loaded 9 documents (347 chunks)
✓ Using Apple Foundation Models (on-device + PCC)
🔥 [Warm-up] Foundation Model preloaded in 8.36s
📝 Query: Test
✓ Expanded to 1 query variations in 2ms
⚡️ Cache hit! Returning 3 cached results
✅ Response generated in 12.29s
```

## Performance Impact

Logging has overhead:

| Level | CPU Impact | Memory Impact | Recommended Use |
|-------|------------|---------------|-----------------|
| Silent | 0% | 0 MB | Production only |
| Error | <0.1% | <1 MB | Production/TestFlight |
| Warning | <0.5% | <2 MB | Beta testing |
| Info | 1-2% | 2-5 MB | Development (default) |
| Debug | 3-5% | 5-10 MB | Debugging specific issues |
| Verbose | 10-15% | 10-20 MB | Deep debugging only |

**Streaming logs** add significant overhead during response generation:
- Info level: ~50 log lines per response
- Verbose level: ~500 log lines per response (1 per token)

## Quick Command Reference

### Set Level to Info (Default)
Settings → Developer Settings → Logging Level → Info

### Disable Token Streaming
Settings → Developer Settings → Token Streaming → OFF

### Production Mode
Settings → Developer Settings → Presets → Production (Minimal)

### Xcode Filter for App Logs Only
```
[RAG
```

### Xcode Filter to Hide System Warnings
```
-NSMapGet -Reporter -UIKeyboard -metal-HUD -CAMetalLayer
```

## Troubleshooting

### "Still seeing too many logs"
1. Check Developer Settings → ensure Streaming is OFF
2. Apply "Development (Balanced)" preset
3. Add Xcode filter: `-NSMapGet -Reporter -metal`

### "Not seeing any logs"
1. Check Developer Settings → Level should be Info or higher
2. Remove all Xcode console filters
3. Check categories are enabled

### "System warnings still appearing"
- **Expected behavior** - these cannot be suppressed
- Use Xcode console filters to hide them
- They don't affect app performance or user experience

## Best Practices

1. ✅ **Use Info level** for daily development
2. ✅ **Disable Streaming logs** unless debugging streaming
3. ✅ **Use Xcode filters** to hide system warnings
4. ✅ **Switch to Error level** before TestFlight builds
5. ✅ **Use Debug/Verbose** only when actively debugging
6. ✅ **Apply presets** instead of manual configuration
7. ❌ **Don't leave Verbose on** - high CPU/memory impact
8. ❌ **Don't try to suppress iOS warnings** - it's not possible

## Summary

**For Clean Development Experience:**
1. Settings → Developer Settings → Apply "Development (Balanced)" preset
2. Xcode console filter: `-NSMapGet -Reporter -metal-HUD`
3. Result: Key operations visible, system spam hidden ✅

**For Production:**
1. Settings → Developer Settings → Apply "Production (Minimal)" preset
2. Result: Error-only logging, minimal overhead ✅

---

**Last Updated**: October 2025
**Status**: Developer Settings Available ✅
**Next**: More granular category controls
